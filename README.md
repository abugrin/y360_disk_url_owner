# Y360 Disk URL Owner

Приложение для определения владельца ресурса на Яндекс Диске по публичной ссылке.

> Приложение предоставляется как есть и является примером использования API.

## Требования

- **Python 3.11** или выше
- **API токен** Яндекс 360 с необходимыми правами доступа

### Необходимые права доступа (scope)

Для работы приложения токен должен иметь следующие права:

- `cloud_api:disk.read` — для получения информации о ресурсах на диске
- `directory:read_users` — для получения информации о пользователях

### Получение токена

Для получения OAuth токена с необходимыми правами доступа:

1. Перейдите на страницу [Доступ к API](https://yandex.ru/dev/api360/doc/ru/access)
2. Создайте или используйте существующее OAuth приложение
3. Запросите токен с необходимыми scope (см. выше)
4. Скопируйте полученный токен для использования в приложении

## Установка и запуск

### Для пользователей Windows

#### Шаг 1: Установка Python

1. Скачайте Python с официального сайта: https://www.python.org/downloads/
2. Запустите установщик
3. **ВАЖНО**: Отметьте галочку "Add Python to PATH" в начале установки
4. Нажмите "Install Now"
5. После установки откройте командную строку (нажмите Win+R, введите `cmd` и нажмите Enter)
6. Проверьте установку командой:
   ```cmd
   python --version
   ```

#### Шаг 2: Установка uv (менеджер пакетов)

В командной строке выполните:
```cmd
pip install uv
```

#### Шаг 3: Запуск приложения

Выберите один из вариантов:

**Вариант А: Запуск без установки (используя uvx)**

```cmd
uvx --from git+https://github.com/abugrin/y360_disk_url_owner.git y360-disk-owner
```

**Вариант Б: Установка и запуск**

```cmd
uv tool install git+https://github.com/abugrin/y360_disk_url_owner.git
y360-disk-owner
```

---

### Для пользователей macOS

#### Шаг 1: Установка Python

Python обычно предустановлен на macOS, но рекомендуется установить актуальную версию:

1. Откройте Terminal (Finder → Программы → Утилиты → Terminal)
2. Установите Homebrew (если ещё не установлен):
   ```bash
   /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
   ```
3. Установите Python:
   ```bash
   brew install python@3.11
   ```
4. Проверьте установку:
   ```bash
   python3 --version
   ```

#### Шаг 2: Установка uv

```bash
pip3 install uv
```

#### Шаг 3: Запуск приложения

**Вариант А: Запуск без установки (используя uvx)**

```bash
uvx --from git+https://github.com/abugrin/y360_disk_url_owner.git y360-disk-owner
```

**Вариант Б: Установка и запуск**

```bash
uv tool install git+https://github.com/abugrin/y360_disk_url_owner.git
y360-disk-owner
```

---

### Для пользователей Linux (Ubuntu/Debian)

#### Шаг 1: Установка Python

1. Откройте терминал (Ctrl+Alt+T)
2. Обновите список пакетов:
   ```bash
   sudo apt update
   ```
3. Установите Python:
   ```bash
   sudo apt install python3.11 python3-pip
   ```
4. Проверьте установку:
   ```bash
   python3 --version
   ```

#### Шаг 2: Установка uv

```bash
pip3 install uv
```

Если команда `pip3` не найдена, выполните:
```bash
sudo apt install python3-pip
pip3 install uv
```

#### Шаг 3: Добавление пути к исполняемым файлам Python

Добавьте следующую строку в файл `~/.bashrc` или `~/.zshrc`:

```bash
export PATH="$HOME/.local/bin:$PATH"
```

Затем перезагрузите конфигурацию:

```bash
source ~/.bashrc
```

#### Шаг 4: Запуск приложения

**Вариант А: Запуск без установки (используя uvx)**

```bash
uvx --from git+https://github.com/abugrin/y360_disk_url_owner.git y360-disk-owner
```

**Вариант Б: Установка и запуск**

```bash
uv tool install git+https://github.com/abugrin/y360_disk_url_owner.git
y360-disk-owner
```

---

## Использование

### Первый запуск

При первом запуске приложение предложит настроить параметры:

1. Запустите приложение командой `y360-disk-owner`
2. Введите OAuth токен для доступа к Яндекс 360 API
3. Введите ID организации (org_id)
4. Приложение проверит токен через API и покажет ваш логин
5. Приложение проверит наличие необходимых прав доступа (scope)
6. Настройки будут сохранены для последующих запусков

### Последующие запуски

При последующих запусках:

1. Приложение покажет замаскированный токен и org_id
2. Вы можете:
   - **[1]** Продолжить с текущими настройками
   - **[2]** Изменить настройки
   - **[3]** Выйти

### Поиск владельца файла

1. Скопируйте публичную ссылку на файл в Яндекс Диске
2. Вставьте её в приложение (Ctrl+V или Cmd+V на macOS)
3. Приложение покажет информацию о владельце:
   - UID пользователя
   - Email
   - Имя
   - Фамилию
   - Отчество
   - Логин
   - Должность (если указана)
4. После отображения результата приложение автоматически вернётся к вводу следующего URL
5. Для выхода введите `q`, `quit` или `exit`

### Поддерживаемые форматы ссылок

Приложение поддерживает три формата ссылок на Яндекс Диск:

1. **Короткая ссылка**:
   ```
   https://disk.yandex.ru/d/446d6f44-bb36-48bb-973c-4e1c71e33ccd
   ```

2. **Полная ссылка с хешем**:
   ```
   https://disk.yandex.ru/public/?hash=dAEMkc1QDY4SPb5+BlFnEKkx1oWX7/p5zYSCvHGQ5/6FQeE4ICFyXScld621gdJYq/J6bpmRyOJonT3VoXnDag==
   ```

3. **Просто хеш**:
   ```
   dAEMkc1QDY4SPb5+BlFnEKkx1oWX7/p5zYSCvHGQ5/6FQeE4ICFyXScld621gdJYq/J6bpmRyOJonT3VoXnDag==
   ```

### Где хранятся настройки?

Настройки (токен и org_id) сохраняются в файле `.env` в директории:

- **Windows**: `C:\Users\ИмяПользователя\.y360_disk_owner\.env`
- **macOS/Linux**: `~/.y360_disk_owner/.env`

## Решение проблем

### Ошибка "command not found" после установки

**Windows:**
Перезапустите командную строку после установки.

**macOS/Linux:**
Убедитесь, что путь к исполняемым файлам добавлен в PATH:
```bash
export PATH="$HOME/.local/bin:$PATH"
```

### Ошибка "Недостаточно прав доступа"

Убедитесь, что ваш OAuth токен имеет необходимые scope:
- `cloud_api:disk.read` (или `cloud_api:disk.write`)
- `directory:read_users` (или `directory:write_users`)

При изменении прав токена потребуется получить новый токен

### Ошибка "Публичный ресурс не найден"

Это может означать:
- Ссылка некорректна или устарела
- Ресурс не является публичным
- Ресурс не принадлежит вашей организации

### Ошибка подключения к API

- Проверьте наличие доступа к интернету
- Убедитесь в правильности введённого токена

## Локальная разработка

Для локальной разработки:

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/abugrin/y360_disk_url_owner.git
   cd y360_disk_url_owner
   ```

2. Установите зависимости:
   ```bash
   uv sync
   ```

3. Запустите приложение:
   ```bash
   uv run y360-disk-owner
   ```

## Структура проекта

```
y360_disk_url_owner/
├── y360_disk_url_owner/
│   ├── __init__.py          # Инициализация пакета
│   ├── main.py              # Главная логика и entry point
│   ├── config.py            # Управление конфигурацией
│   ├── api_client.py        # Клиент для Яндекс 360 API
│   ├── url_parser.py        # Парсинг URL
│   └── ui.py                # Пользовательский интерфейс (Rich)
├── examples/                # Примеры использования API
├── pyproject.toml           # Конфигурация проекта
├── README.md                # Документация
└── LICENSE                  # Лицензия MIT
```

## Лицензия

MIT License. См. файл [LICENSE](LICENSE) для подробностей.
